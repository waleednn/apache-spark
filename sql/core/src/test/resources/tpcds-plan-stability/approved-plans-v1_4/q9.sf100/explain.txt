== Physical Plan ==
* Project (4)
+- * Filter (3)
   +- * ColumnarToRow (2)
      +- Scan parquet spark_catalog.default.reason (1)


(1) Scan parquet spark_catalog.default.reason
Output [1]: [r_reason_sk#1]
Batched: true
Location [not included in comparison]/{warehouse_dir}/reason]
PushedFilters: [IsNotNull(r_reason_sk), EqualTo(r_reason_sk,1)]
ReadSchema: struct<r_reason_sk:int>

(2) ColumnarToRow [codegen id : 1]
Input [1]: [r_reason_sk#1]

(3) Filter [codegen id : 1]
Input [1]: [r_reason_sk#1]
Condition : (isnotnull(r_reason_sk#1) AND (r_reason_sk#1 = 1))

(4) Project [codegen id : 1]
Output [5]: [CASE WHEN (Subquery scalar-subquery#2, [id=#3].count(1) > 62316685) THEN ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_ext_discount_amt) ELSE ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_net_paid) END AS bucket1#4, CASE WHEN (ReusedSubquery Subquery scalar-subquery#2, [id=#3].count(1) > 19045798) THEN ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_ext_discount_amt) ELSE ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_net_paid) END AS bucket2#5, CASE WHEN (ReusedSubquery Subquery scalar-subquery#2, [id=#3].count(1) > 365541424) THEN ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_ext_discount_amt) ELSE ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_net_paid) END AS bucket3#6, CASE WHEN (ReusedSubquery Subquery scalar-subquery#2, [id=#3].count(1) > 216357808) THEN ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_ext_discount_amt) ELSE ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_net_paid) END AS bucket4#7, CASE WHEN (ReusedSubquery Subquery scalar-subquery#2, [id=#3].count(1) > 184483884) THEN ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_ext_discount_amt) ELSE ReusedSubquery Subquery scalar-subquery#2, [id=#3].avg(ss_net_paid) END AS bucket5#8]
Input [1]: [r_reason_sk#1]

===== Subqueries =====

Subquery:1 Hosting operator id = 4 Hosting Expression = Subquery scalar-subquery#2, [id=#3]
* Project (12)
+- * HashAggregate (11)
   +- Exchange (10)
      +- * HashAggregate (9)
         +- * Project (8)
            +- * Filter (7)
               +- * ColumnarToRow (6)
                  +- Scan parquet spark_catalog.default.store_sales (5)


(5) Scan parquet spark_catalog.default.store_sales
Output [4]: [ss_quantity#9, ss_ext_discount_amt#10, ss_net_paid#11, ss_sold_date_sk#12]
Batched: true
Location [not included in comparison]/{warehouse_dir}/store_sales]
PushedFilters: [IsNotNull(ss_quantity), Or(Or(Or(Or(Or(Or(Or(Or(Or(Or(Or(Or(And(GreaterThanOrEqual(ss_quantity,1),LessThanOrEqual(ss_quantity,20)),And(GreaterThanOrEqual(ss_quantity,21),LessThanOrEqual(ss_quantity,40))),And(GreaterThanOrEqual(ss_quantity,21),LessThanOrEqual(ss_quantity,40))),And(GreaterThanOrEqual(ss_quantity,21),LessThanOrEqual(ss_quantity,40))),And(GreaterThanOrEqual(ss_quantity,41),LessThanOrEqual(ss_quantity,60))),And(GreaterThanOrEqual(ss_quantity,41),LessThanOrEqual(ss_quantity,60))),And(GreaterThanOrEqual(ss_quantity,41),LessThanOrEqual(ss_quantity,60))),And(GreaterThanOrEqual(ss_quantity,61),LessThanOrEqual(ss_quantity,80))),And(GreaterThanOrEqual(ss_quantity,61),LessThanOrEqual(ss_quantity,80))),And(GreaterThanOrEqual(ss_quantity,61),LessThanOrEqual(ss_quantity,80))),And(GreaterThanOrEqual(ss_quantity,81),LessThanOrEqual(ss_quantity,100))),And(GreaterThanOrEqual(ss_quantity,81),LessThanOrEqual(ss_quantity,100))),And(GreaterThanOrEqual(ss_quantity,81),LessThanOrEqual(ss_quantity,100)))]
ReadSchema: struct<ss_quantity:int,ss_ext_discount_amt:decimal(7,2),ss_net_paid:decimal(7,2)>

(6) ColumnarToRow [codegen id : 1]
Input [4]: [ss_quantity#9, ss_ext_discount_amt#10, ss_net_paid#11, ss_sold_date_sk#12]

(7) Filter [codegen id : 1]
Input [4]: [ss_quantity#9, ss_ext_discount_amt#10, ss_net_paid#11, ss_sold_date_sk#12]
Condition : (isnotnull(ss_quantity#9) AND ((((((((((((((ss_quantity#9 >= 1) AND (ss_quantity#9 <= 20)) OR ((ss_quantity#9 >= 21) AND (ss_quantity#9 <= 40))) OR ((ss_quantity#9 >= 21) AND (ss_quantity#9 <= 40))) OR ((ss_quantity#9 >= 21) AND (ss_quantity#9 <= 40))) OR ((ss_quantity#9 >= 41) AND (ss_quantity#9 <= 60))) OR ((ss_quantity#9 >= 41) AND (ss_quantity#9 <= 60))) OR ((ss_quantity#9 >= 41) AND (ss_quantity#9 <= 60))) OR ((ss_quantity#9 >= 61) AND (ss_quantity#9 <= 80))) OR ((ss_quantity#9 >= 61) AND (ss_quantity#9 <= 80))) OR ((ss_quantity#9 >= 61) AND (ss_quantity#9 <= 80))) OR ((ss_quantity#9 >= 81) AND (ss_quantity#9 <= 100))) OR ((ss_quantity#9 >= 81) AND (ss_quantity#9 <= 100))) OR ((ss_quantity#9 >= 81) AND (ss_quantity#9 <= 100))))

(8) Project [codegen id : 1]
Output [7]: [ss_ext_discount_amt#10, ss_net_paid#11, (isnotnull(ss_quantity#9) AND ((ss_quantity#9 >= 1) AND (ss_quantity#9 <= 20))) AS propagatedFilter#13, (isnotnull(ss_quantity#9) AND ((ss_quantity#9 >= 21) AND (ss_quantity#9 <= 40))) AS propagatedFilter#14, (isnotnull(ss_quantity#9) AND ((ss_quantity#9 >= 41) AND (ss_quantity#9 <= 60))) AS propagatedFilter#15, (isnotnull(ss_quantity#9) AND ((ss_quantity#9 >= 61) AND (ss_quantity#9 <= 80))) AS propagatedFilter#16, (isnotnull(ss_quantity#9) AND ((ss_quantity#9 >= 81) AND (ss_quantity#9 <= 100))) AS propagatedFilter#17]
Input [4]: [ss_quantity#9, ss_ext_discount_amt#10, ss_net_paid#11, ss_sold_date_sk#12]

(9) HashAggregate [codegen id : 1]
Input [7]: [ss_ext_discount_amt#10, ss_net_paid#11, propagatedFilter#13, propagatedFilter#14, propagatedFilter#15, propagatedFilter#16, propagatedFilter#17]
Keys: []
Functions [15]: [partial_count(1) FILTER (WHERE propagatedFilter#13), partial_avg(UnscaledValue(ss_ext_discount_amt#10)) FILTER (WHERE propagatedFilter#13), partial_avg(UnscaledValue(ss_net_paid#11)) FILTER (WHERE propagatedFilter#13), partial_count(1) FILTER (WHERE propagatedFilter#14), partial_avg(UnscaledValue(ss_ext_discount_amt#10)) FILTER (WHERE propagatedFilter#14), partial_avg(UnscaledValue(ss_net_paid#11)) FILTER (WHERE propagatedFilter#14), partial_count(1) FILTER (WHERE propagatedFilter#15), partial_avg(UnscaledValue(ss_ext_discount_amt#10)) FILTER (WHERE propagatedFilter#15), partial_avg(UnscaledValue(ss_net_paid#11)) FILTER (WHERE propagatedFilter#15), partial_count(1) FILTER (WHERE propagatedFilter#16), partial_avg(UnscaledValue(ss_ext_discount_amt#10)) FILTER (WHERE propagatedFilter#16), partial_avg(UnscaledValue(ss_net_paid#11)) FILTER (WHERE propagatedFilter#16), partial_count(1) FILTER (WHERE propagatedFilter#17), partial_avg(UnscaledValue(ss_ext_discount_amt#10)) FILTER (WHERE propagatedFilter#17), partial_avg(UnscaledValue(ss_net_paid#11)) FILTER (WHERE propagatedFilter#17)]
Aggregate Attributes [25]: [count#18, sum#19, count#20, sum#21, count#22, count#23, sum#24, count#25, sum#26, count#27, count#28, sum#29, count#30, sum#31, count#32, count#33, sum#34, count#35, sum#36, count#37, count#38, sum#39, count#40, sum#41, count#42]
Results [25]: [count#43, sum#44, count#45, sum#46, count#47, count#48, sum#49, count#50, sum#51, count#52, count#53, sum#54, count#55, sum#56, count#57, count#58, sum#59, count#60, sum#61, count#62, count#63, sum#64, count#65, sum#66, count#67]

(10) Exchange
Input [25]: [count#43, sum#44, count#45, sum#46, count#47, count#48, sum#49, count#50, sum#51, count#52, count#53, sum#54, count#55, sum#56, count#57, count#58, sum#59, count#60, sum#61, count#62, count#63, sum#64, count#65, sum#66, count#67]
Arguments: SinglePartition, ENSURE_REQUIREMENTS, [plan_id=1]

(11) HashAggregate [codegen id : 2]
Input [25]: [count#43, sum#44, count#45, sum#46, count#47, count#48, sum#49, count#50, sum#51, count#52, count#53, sum#54, count#55, sum#56, count#57, count#58, sum#59, count#60, sum#61, count#62, count#63, sum#64, count#65, sum#66, count#67]
Keys: []
Functions [15]: [count(1), avg(UnscaledValue(ss_ext_discount_amt#10)), avg(UnscaledValue(ss_net_paid#11)), count(1), avg(UnscaledValue(ss_ext_discount_amt#10)), avg(UnscaledValue(ss_net_paid#11)), count(1), avg(UnscaledValue(ss_ext_discount_amt#10)), avg(UnscaledValue(ss_net_paid#11)), count(1), avg(UnscaledValue(ss_ext_discount_amt#10)), avg(UnscaledValue(ss_net_paid#11)), count(1), avg(UnscaledValue(ss_ext_discount_amt#10)), avg(UnscaledValue(ss_net_paid#11))]
Aggregate Attributes [15]: [count(1)#68, avg(UnscaledValue(ss_ext_discount_amt#10))#69, avg(UnscaledValue(ss_net_paid#11))#70, count(1)#71, avg(UnscaledValue(ss_ext_discount_amt#10))#72, avg(UnscaledValue(ss_net_paid#11))#73, count(1)#74, avg(UnscaledValue(ss_ext_discount_amt#10))#75, avg(UnscaledValue(ss_net_paid#11))#76, count(1)#77, avg(UnscaledValue(ss_ext_discount_amt#10))#78, avg(UnscaledValue(ss_net_paid#11))#79, count(1)#80, avg(UnscaledValue(ss_ext_discount_amt#10))#81, avg(UnscaledValue(ss_net_paid#11))#82]
Results [15]: [count(1)#68 AS count(1)#83, cast((avg(UnscaledValue(ss_ext_discount_amt#10))#69 / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#84, cast((avg(UnscaledValue(ss_net_paid#11))#70 / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#85, count(1)#71 AS count(1)#86, cast((avg(UnscaledValue(ss_ext_discount_amt#10))#72 / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#87, cast((avg(UnscaledValue(ss_net_paid#11))#73 / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#88, count(1)#74 AS count(1)#89, cast((avg(UnscaledValue(ss_ext_discount_amt#10))#75 / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#90, cast((avg(UnscaledValue(ss_net_paid#11))#76 / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#91, count(1)#77 AS count(1)#92, cast((avg(UnscaledValue(ss_ext_discount_amt#10))#78 / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#93, cast((avg(UnscaledValue(ss_net_paid#11))#79 / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#94, count(1)#80 AS count(1)#95, cast((avg(UnscaledValue(ss_ext_discount_amt#10))#81 / 100.0) as decimal(11,6)) AS avg(ss_ext_discount_amt)#96, cast((avg(UnscaledValue(ss_net_paid#11))#82 / 100.0) as decimal(11,6)) AS avg(ss_net_paid)#97]

(12) Project [codegen id : 2]
Output [1]: [named_struct(count(1), count(1)#83, avg(ss_ext_discount_amt), avg(ss_ext_discount_amt)#84, avg(ss_net_paid), avg(ss_net_paid)#85, count(1), count(1)#86, avg(ss_ext_discount_amt), avg(ss_ext_discount_amt)#87, avg(ss_net_paid), avg(ss_net_paid)#88, count(1), count(1)#89, avg(ss_ext_discount_amt), avg(ss_ext_discount_amt)#90, avg(ss_net_paid), avg(ss_net_paid)#91, count(1), count(1)#92, avg(ss_ext_discount_amt), avg(ss_ext_discount_amt)#93, avg(ss_net_paid), avg(ss_net_paid)#94, count(1), count(1)#95, avg(ss_ext_discount_amt), avg(ss_ext_discount_amt)#96, avg(ss_net_paid), avg(ss_net_paid)#97) AS mergedValue#98]
Input [15]: [count(1)#83, avg(ss_ext_discount_amt)#84, avg(ss_net_paid)#85, count(1)#86, avg(ss_ext_discount_amt)#87, avg(ss_net_paid)#88, count(1)#89, avg(ss_ext_discount_amt)#90, avg(ss_net_paid)#91, count(1)#92, avg(ss_ext_discount_amt)#93, avg(ss_net_paid)#94, count(1)#95, avg(ss_ext_discount_amt)#96, avg(ss_net_paid)#97]

Subquery:2 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:3 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:4 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:5 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:6 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:7 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:8 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:9 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:10 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:11 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:12 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:13 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:14 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]

Subquery:15 Hosting operator id = 4 Hosting Expression = ReusedSubquery Subquery scalar-subquery#2, [id=#3]


