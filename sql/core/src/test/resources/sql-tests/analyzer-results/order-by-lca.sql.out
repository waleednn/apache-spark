-- Automatically generated by SQLQueryTestSuite
-- !query
SELECT id % 2 AS id2, id + id2 + 1 FROM range(4) ORDER BY id2
-- !query analysis
Sort [id2#xL ASC NULLS FIRST], true
+- Project [id2#xL, ((id#xL + id2#xL) + cast(1 as bigint)) AS ((id + lateralAliasReference(id2)) + 1)#xL]
   +- Project [id#xL, (id#xL % cast(2 as bigint)) AS id2#xL]
      +- Range (0, 4, step=1)


-- !query
SELECT max(id) AS id FROM range(4) ORDER BY avg(id)
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_FEATURE.LATERAL_COLUMN_ALIAS_IN_AGGREGATE_FUNC",
  "sqlState" : "0A000",
  "messageParameters" : {
    "aggFunc" : "\"avg(lateralAliasReference(id))\"",
    "lca" : "`id`"
  }
}


-- !query
SELECT max(id) AS id FROM range(4) GROUP BY id ORDER BY avg(id)
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_FEATURE.LATERAL_COLUMN_ALIAS_IN_AGGREGATE_FUNC",
  "sqlState" : "0A000",
  "messageParameters" : {
    "aggFunc" : "\"avg(lateralAliasReference(id))\"",
    "lca" : "`id`"
  }
}


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY avg(id2)
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_FEATURE.LATERAL_COLUMN_ALIAS_IN_AGGREGATE_FUNC",
  "sqlState" : "0A000",
  "messageParameters" : {
    "aggFunc" : "\"avg(lateralAliasReference(id2))\"",
    "lca" : "`id2`"
  }
}


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY avg(id2 / 2)
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_FEATURE.LATERAL_COLUMN_ALIAS_IN_AGGREGATE_FUNC",
  "sqlState" : "0A000",
  "messageParameters" : {
    "aggFunc" : "\"avg((lateralAliasReference(id2) / 2))\"",
    "lca" : "`id2`"
  }
}


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY avg(id2) / 1
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_FEATURE.LATERAL_COLUMN_ALIAS_IN_AGGREGATE_FUNC",
  "sqlState" : "0A000",
  "messageParameters" : {
    "aggFunc" : "\"avg(lateralAliasReference(id2))\"",
    "lca" : "`id2`"
  }
}


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY cast(id2 as string)
-- !query analysis
Sort [cast(id2#xL as string) ASC NULLS FIRST], true
+- Aggregate [max(id#xL) AS id2#xL]
   +- Range (0, 4, step=1)


-- !query
SELECT max(id) AS id FROM range(4) ORDER BY id
-- !query analysis
Sort [id#xL ASC NULLS FIRST], true
+- Aggregate [max(id#xL) AS id#xL]
   +- Range (0, 4, step=1)


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY id2
-- !query analysis
Sort [id2#xL ASC NULLS FIRST], true
+- Aggregate [max(id#xL) AS id2#xL]
   +- Range (0, 4, step=1)


-- !query
SELECT max(id) AS id2 FROM range(4) ORDER BY id2 / 2
-- !query analysis
Sort [(cast(id2#xL as double) / cast(2 as double)) ASC NULLS FIRST], true
+- Aggregate [max(id#xL) AS id2#xL]
   +- Range (0, 4, step=1)


-- !query
SELECT id % 2 AS id FROM range(4) ORDER BY id
-- !query analysis
Sort [id#xL ASC NULLS FIRST], true
+- Project [(id#xL % cast(2 as bigint)) AS id#xL]
   +- Range (0, 4, step=1)


-- !query
SELECT id % 2 AS id, id / 2 AS id FROM range(4) ORDER BY id
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "AMBIGUOUS_LATERAL_COLUMN_ALIAS",
  "sqlState" : "42702",
  "messageParameters" : {
    "n" : "2",
    "name" : "`id`"
  }
}


-- !query
SELECT id % 2 AS id2, id / 2 AS id2 FROM range(4) ORDER BY id2
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "AMBIGUOUS_LATERAL_COLUMN_ALIAS",
  "sqlState" : "42702",
  "messageParameters" : {
    "n" : "2",
    "name" : "`id2`"
  }
}
